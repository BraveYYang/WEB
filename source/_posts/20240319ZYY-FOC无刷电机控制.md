---
title: FOC无刷电机控制
tag: 无刷电机控制
date: 2024-04-15
categories: 控制设计
---

# FOC无刷电机控制

## 一、无刷电机基本理解

基本的航模无刷电机结构图如下图所示，**分为前盖，中盖，后盖，磁铁，硅钢片，漆包线、轴承和转轴组成**。

<img src="http://dengfoc.com/dengfoc/shouimage/1-1.png" alt="无刷电机的组成" style="zoom:50%;" />

### 1.可以直接把电机分为定子部分和转子部分：

- **定子**就是有线圈绕组，固定不动的部分；
- **转子**就是电机旋转的部分，用于输出电机的转动和扭矩。

### 2.内外旋转类型区分：

- **内转子无刷电机**就是转子在内部，轴进行旋转；
- **外转子无刷电机**就是转子在外面，外壳进行旋转。

- 而**直流无刷电机的驱动**，就是依靠**改变电机定子线圈的电流交变频率和波形，在定子周围形成磁场，驱动转子永磁体转动**，进而带动电机转起来。

### 3.**无刷电机跟有刷电机的区别**

- 顾名思义就是**无刷电机没有了有刷电机里的电刷**。因此它**不能够如同有刷电机那样采用机械结构就可以进行电流的换向**， 而是必须通过采用如MOS这样的器件实现**电子换向**。

<img src="http://dengfoc.com/dengfoc/shouimage/2-2.png" alt="2-2" style="zoom: 33%;" />

<img src="http://dengfoc.com/dengfoc/shouimage/2-4.png" alt="2-4" style="zoom: 33%;" />

<img src="http://dengfoc.com/dengfoc/shouimage/2-5.png" alt="2-5" style="zoom: 50%;" />

- **对电机的控制实际上就是对MOS管开关规律的控制**。而MOS管的开关规律是需要用到单片机程序进行控制的，因此这就引出了我们的**FOC控制算法，FOC控制就是一种对电机运动模型进行抽象化和简化，进而有规律控制各个MOS管开关和通断的过程**。

## 二、克拉克变换

### 1.克拉克变换基本含义

- 交替开关的MOS管可以实现电机的转动，而这些交替开关的MOS管是以极其快的速度在周期性进行的，把这些周期性的开启和关断过程联系起来，并且对其各个相进行单独观察，就可以得到三个相A、B、C的电流随时间变换的曲线，如下图所示，他们之间存在120°的相位差。换一个角度来思考此问题，实际上，我们只要能够**控制这个相位差为120°的sin状波形，就能够实现针对电机的控制**。

![3.1-1](http://dengfoc.com/dengfoc/shouimage/3.1-1.png)

- **克拉克变换，实际上就是降维解耦的过程，把难以辨明和控制的三相相位差120°电机波形降维为两维矢量**。

- **第一就是把三相随时间变换的，相位差为120°的电流波形抽象化为三个间隔120°的矢量**。

- **第二就是利用三角函数对矢量进行降维，降维到两个坐标轴**，从此复杂的三相变化问题就降解为了α-β坐标轴的坐标上的数值变化问题。

<img src="http://dengfoc.com/dengfoc/shouimage/3.1-3.png" alt="3.1-3" style="zoom:50%;" />

<img src="http://dengfoc.com/dengfoc/shouimage/3.1-4.png" alt="3.1-4" style="zoom:67%;" />

- 上图中，左边是我们把三相120度相位差的sin状波形抽象化为矢量之后的样子，而右边就是我们需要**把这三个矢量进行投影的坐标轴。只要我们把三个矢量都投影到坐标轴上，那么，一个三矢量问题就变成一个二维坐标平面问题**。

### 2.克拉克变换推导公式

- **克拉克变换的第一步，作投影**

- 针对α-β坐标系中α轴，有：

<img src="https://s2.loli.net/2024/07/25/YO6LurHIQkSfV21.png" alt="image-20240318150726168.png" style="zoom:50%;" />

- 针对α-β坐标系中β轴，有：

<img src="https://s2.loli.net/2024/07/25/ZUyTqOcmRVtHSe7.png" alt="image-20240318150741335.png" style="zoom:50%;" />

- 把上面的投影结果列成矩阵形式，有：

<img src="https://s2.loli.net/2024/07/25/xR4twW1ynvGp2ou.png" alt="image-20240318150755362.png" style="zoom:50%;" />

### 3.克拉克变换的等辐值形式

- 何为等幅值变换？用α相电流输入1A电流的特例来举例，当电流输入时候，根据基尔霍夫电流定律（电路中任一个节点上，在任意时刻，流入节点的电流之和等于流出节点的电流之和，如下图），有：

<img src="https://s2.loli.net/2024/07/25/fSHMDIEoRj4JsOl.png" alt="image-20240318151006334.png" style="zoom:67%;" />

<img src="https://s2.loli.net/2024/07/25/1bvRp6E8T3Q5dPk.png" alt="image-20240318152249217.png" style="zoom:50%;" />

<img src="https://s2.loli.net/2024/07/25/esquFgkWVyZpf4c.png" alt="image-20240318152309335.png" style="zoom:50%;" />

<img src="https://s2.loli.net/2024/07/25/58PAe2iML9I1uDW.png" alt="image-20240319174421088.png" style="zoom:50%;" />

<img src="https://s2.loli.net/2024/07/25/qxy9OB8GJH2frNj.png" alt="image-20240319174945752.png" style="zoom:50%;" />

- 在式子中，我们消去了变量Ic，这是因为由于基尔霍夫电流定律的存在，我们并不需要知道所有三相电流，我们只需要知道两相电流就能够求解得到另外一相的电流，反映在硬件上，**我们就可以省去一路的电流传感器！节省了成本！**

### 4.克拉克逆变换

<img src="https://s2.loli.net/2024/07/25/eYjA7Q6pOFBVcNo.png" alt="image-20240319175252143.png" style="zoom:50%;" />

<img src="https://s2.loli.net/2024/07/25/Rbtm5MOlFEc8k1d.png" alt="image-20240319175403342.png" style="zoom:50%;" />

### 5.克拉克变换总结

- 克拉克变换首先将**三相电流转换成两维度的矢量电流**，因此我们就可以通过**控制两维度的矢量电流来表达三项电流的变换情况**，并且通过等幅值变换，我们就可以将**电流进行消项，之后又可以消去一路Ic，优化处理速度**；

- 而克拉克逆变换的目的是我们通**过需求的两项矢量电流来反向求解三相电流，并且来控制无刷电机驱动。**

## 三、帕克变换

### 1.帕克变换基本定义

- 通过克拉克变换之后，我们就将三相电路降阶至二维矢量电流，但是电流和电机旋转角度的关系是未知的，还需要将这个理论和旋转电机对应起来，也就是**建立电机旋转时的数学模型**，这就是帕克变换的目的。

- 其实整个帕克变换的思路很简单，首先，我们把电机的定子t线圈上固定一个Iα−Iβ坐标系，这时候，我在坐标系的右边放上一个转子，如下图右边所示，如果此时转子被吸引且不动，那么在Iα−Iβ坐标系中就一定有一个Iα和Iβ值是能够对应转子现在的状态的

![3.3-2](http://dengfoc.com/dengfoc/shouimage/3.3-2.png)

![3.3-3](http://dengfoc.com/dengfoc/shouimage/3.3-3.png)

### 2.帕克变换推导公式

- 根据上图，可以推导Iα−Iβ坐标系于Iq−Id坐标系的关系，这也就是帕克变换：

![image-20240320174459687.png](https://s2.loli.net/2024/07/25/fahwsKAl9RnDUr6.png)

- 在实际的情况中，电角度是可以根据传感器求解得出，因此，我们只需要控制Iq和Id的电流，就可以控制无刷电机的旋转，而我们可以将Id设置成0，因此，我们只需要一个Iq的电流，就可以控制电机旋转。

## 四、推导原理总结



<img src="http://dengfoc.com/dengfoc/shouimage/3.4-1.png" alt="3.4-1" style="zoom:50%;" />

- **电机想要旋转，就需要三相电流相互作用，而三项电流可以通过克拉克变换转成二维的矢量，而这个二维的矢量通过和转子的电角度建立关系，即可得出控制的电流Iq（Id默认为0），因此我们仅仅只需要通过设定Iq就可以控制电机进行旋转。**

## 五、电压形式转换

- 因为单片机的控制都是**基于电压进行控制**，包括PWM的控制，也是通过控制电压进行设定，因此我们需要将电流转换成电压形式，**而电压和电流的转换可以直接等于，因为等号两边都需要除以电阻，可以直接消项。**

<img src="https://s2.loli.net/2024/07/25/GQ3qP7uYbaWCotK.png" alt="image-20240320180833702.png" style="zoom:50%;" />

<img src="https://s2.loli.net/2024/07/25/ZwqigGLHyDB9tFb.png" alt="image-20240320181038012.png" style="zoom:50%;" />

## 六、电角度于机械角度

<img src="https://s2.loli.net/2024/07/25/IqfPkovwQDlSTR9.png" alt="image-20240320182308979.png" style="zoom:50%;" />

<img src="https://s2.loli.net/2024/07/25/76QqI34TyP5rozm.png" alt="image-20240320182250898.png" style="zoom:50%;" />

- **极对数：是N极和S极的对数数量**

- **电角度：电角度是定子电流矢量与转子磁极矢量之间的夹角**

- **机械角度：电机旋转一圈的空间几何角度，旋转一圈为360度**
- 如果只是刚刚的一级对电机，那么的机械角度转一圈，相位的一个周期是能够和机械角度一一对应的，此时电角度=机械角度；但是，如果是多级电机，那么机械角度转一圈，相位的周期可能是很多个。

