---
title: DShot协议
tag: DShot协议
date: 2024-09-29
categories: Fly
index_img: 

---

# DShot协议

## 感谢博主

https://blog.csdn.net/weixin_39939185/article/details/132066139

## DShot协议的时间长短

在Dshot中，**1的高电平时长是0的两倍**。帧的实际持续时长、位的周期时长和帧长度取决于Dshot版本：

| Dshot | 比特率     | T1H   | T0H   | 位(μs) | 帧(μs) |
| ----- | ---------- | ----- | ----- | ------ | ------ |
| 150   | 150kbit/s  | 5.00  | 2.50  | 6.67   | 106.72 |
| 300   | 300kbit/s  | 2.50  | 1.25  | 3.33   | 53.28  |
| 600   | 600kbit/s  | 1.25  | 0.625 | 1.67   | 26.72  |
| 1200  | 1200kbit/s | 0.625 | 0.313 | 0.83   | 13.28  |

## 帧的表示情况

11位油门信号：共有2048个不同的值。0保留为上锁命令，1-47被保留为特殊命令。剩下的48-2047（共2000步）用于实际的油门值

1位回传请求：如果设置了这一位，那么遥测数据将通过另外一根专线（电调回传线）单独发回飞控

4位CRC(Cyclic Redundancy Checksum，循环冗余校验)：检验数据的有效性（包括油门数据以及回传请求位）

![image.png](https://s2.loli.net/2024/09/29/v3jhNAL8yuH7rFM.png)

#### 1-47特殊命令

```
1-5：beep（1= low freq. 5 = high freq）
6： esc信息请求（fw版本和通过tlm线发送的SN）
7：一个方向旋转
8：另一个方向旋转
9：3d模式关闭
10：3d模式打开
11：esc设置请求（saved settings over the TLM wire）
12：保存设置
```

### 计算CRC

校验和是根据油门数据和遥测位来计算的，因此，下面中的value表示的是前12位数据。

```
crc = (value ^ (value >> 4) ^ (value >>8)) & 0x0f;
```

假设我们正在发送一个1046的油门值（正好是全油门的一半），并且遥测位为0：

```
value  = 100000101100
(>>4)  = 000010000010 # right shift value by 4
(^)    = 100010101110 # XOR with value
(>>8)  = 000000001000 # right shift value by 8
(^)    = 100010100110 # XOR with previous XOR
(0x0F) = 000000001111 # Mask 0x0F
(&)    = 000000000110 # CRC
```

所以，从飞控传输到电调的两个字节的数据是：

```
1000001011000110
```

帧的长度很重要，因为它表示的是电调的更新速率。帧的长度越短，那么每秒发送数据帧的频率就越高。换句话说，比特率越高，我们每秒钟可以发送的数据就越多。